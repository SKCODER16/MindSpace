<!DOCTYPE html>




<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MindSpace | Vibrant Student Support</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Light Mode - Basic Pastel */
            --bg-color: #F8FAFC;
            --surface-color: #FFFFFF;

            /* Basic Pastels (Solid) */
            --gradient-primary: #B2EBF2;
            /* Pastel Cyan */
            --gradient-secondary: #E1BEE7;
            /* Pastel Purple */
            --gradient-warm: #FFCCBC;
            /* Pastel Orange */

            /* Accents */
            --primary: #4DD0E1;
            --secondary: #BA68C8;
            --text-main: #455A64;
            --text-light: #90A4AE;

            /* Mood Colors (Pastel) */
            --mood-awful: #FFAB91;
            --mood-bad: #FFE082;
            --mood-meh: #FFF59D;
            --mood-good: #C5E1A5;
            --mood-great: #80CBC4;

            /* UI Elements */
            --nav-bg: rgba(255, 255, 255, 0.95);
            --shadow-card: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
            --shadow-float: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --radius-lg: 24px;
            --radius-md: 16px;
            --border-light: rgba(0, 0, 0, 0.05);
            --glass: blur(8px);
        }

        [data-theme="dark"] {
            /* Dark Mode - Basic Neutral */
            --bg-color: #121212;
            --surface-color: #1E1E1E;

            /* Neutral/Darkened Pastels */
            --gradient-primary: #37474F;
            --gradient-secondary: #424242;

            --primary: #80CBC4;
            /* Soft Teal */
            --secondary: #CE93D8;
            --text-main: #E0E0E0;
            --text-light: #9E9E9E;

            /* UI Elements */
            --nav-bg: rgba(30, 30, 30, 0.95);
            --shadow-card: 0 4px 6px rgba(0, 0, 0, 0.3);
            --border-light: rgba(255, 255, 255, 0.05);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Outfit', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            min-height: 100vh;
            padding-bottom: 100px;
            overflow-x: hidden;
            transition: background 0.4s ease, color 0.4s ease;
        }

        /* Utilities */
        .container {
            max-width: 500px;
            margin: 0 auto;
            padding: 20px;
        }

        .flex-between {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .flex-center {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .flex-col {
            display: flex;
            flex-direction: column;
        }

        .hidden {
            display: none !important;
        }

        .fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* UI Components */
        .card {
            background: var(--surface-color);
            border-radius: var(--radius-lg);
            padding: 24px;
            margin-bottom: 16px;
            box-shadow: var(--shadow-card);
            border: 1px solid var(--border-light);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-float);
        }

        .btn {
            border: none;
            padding: 14px 24px;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1rem;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 8px;
            justify-content: center;
        }

        .btn:active {
            transform: scale(0.96);
        }

        .btn-primary {
            background: var(--gradient-primary);
            color: white;
            box-shadow: 0 4px 15px rgba(0, 201, 255, 0.3);
        }

        .btn-secondary {
            background: var(--surface-color);
            color: var(--secondary);
            border: 2px solid var(--secondary);
        }

        .btn-danger {
            background: #FF5252;
            color: white;
            box-shadow: 0 4px 15px rgba(255, 82, 82, 0.4);
        }

        /* Header */
        header {
            padding: 15px 0;
            position: sticky;
            top: 0;
            z-index: 50;
            backdrop-filter: var(--glass);
            -webkit-backdrop-filter: var(--glass);
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Mood Grid */
        .mood-grid {
            display: flex;
            justify-content: space-between;
            gap: 8px;
            margin-top: 15px;
        }

        .mood-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: none;
            font-size: 1.8rem;
            background: var(--bg-color);
            cursor: pointer;
            transition: 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .mood-btn.selected {
            transform: scale(1.2) translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        /* Navigation */
        .nav-bar {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--nav-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            padding: 8px 12px;
            border-radius: 40px;
            display: flex;
            gap: 8px;
            box-shadow: var(--shadow-float);
            border: 1px solid var(--border-light);
            z-index: 100;
        }

        .nav-item {
            padding: 12px;
            border-radius: 50%;
            border: none;
            background: transparent;
            color: var(--text-light);
            cursor: pointer;
            transition: 0.3s;
            position: relative;
        }

        .nav-item.active {
            background: var(--gradient-primary);
            color: white;
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 201, 255, 0.4);
        }

        .nav-item svg {
            width: 24px;
            height: 24px;
            stroke-width: 2.5;
        }

        /* Chat */
        .chat-area {
            height: 65vh;
            overflow-y: auto;
            padding: 10px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            scroll-behavior: smooth;
        }

        .msg {
            max-width: 80%;
            padding: 12px 18px;
            border-radius: 20px;
            font-size: 0.95rem;
            line-height: 1.5;
            position: relative;
            animation: popIn 0.3s;
        }

        @keyframes popIn {
            from {
                transform: scale(0.8);
                opacity: 0;
            }

            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .msg-ai {
            background: var(--surface-color);
            border-bottom-left-radius: 4px;
            box-shadow: var(--shadow-card);
        }

        .msg-user {
            background: var(--gradient-primary);
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 4px;
        }

        .typing {
            display: flex;
            gap: 4px;
            padding: 15px;
            background: var(--surface-color);
            width: fit-content;
            border-radius: 20px;
        }

        .dot {
            width: 8px;
            height: 8px;
            background: var(--primary);
            border-radius: 50%;
            animation: bounce 1.4s infinite;
        }

        .dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes bounce {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-6px);
            }
        }

        /* Crisis Overlay */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(8px);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* SOS Button */
        #sosBtn {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #e53935;
            color: white;
            border: none;
            padding: 12px 18px;
            font-size: 16px;
            font-weight: 600;
            border-radius: 50px;
            cursor: pointer;
            z-index: 999;
            box-shadow: 0 6px 20px rgba(229, 57, 53, 0.4);
        }

        #sosBtn:hover {
            background: #c62828;
        }

        /* Modal background */
        .sos-modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.6);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        /* Modal box */
        .sos-box {
            background: white;
            padding: 25px;
            border-radius: 16px;
            max-width: 350px;
            text-align: center;
        }

        .sos-box h2 {
            color: #e53935;
            margin-bottom: 10px;
        }

        .sos-box ul {
            list-style: none;
            padding: 0;
        }

        .sos-box li {
            margin: 10px 0;
            font-size: 15px;
        }

        #closeSos {
            margin-top: 15px;
            padding: 8px 14px;
            border: none;
            border-radius: 8px;
            background: #e53935;
            color: white;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <header class="container flex-between">
        <div class="logo">MindSpace</div>
        <button onclick="toggleTheme()" class="btn" style="padding: 8px; background: transparent;">
            <svg id="themeIcon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                stroke-width="2">
                <circle cx="12" cy="12" r="5"></circle>
                <path
                    d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" />
            </svg>
        </button>
    </header>

    <main id="app" class="container">
        <!-- Default Loading State -->
        <div class="fade-in flex-center flex-col" style="height: 80vh; text-align: center;">
            <div class="logo" style="margin-bottom: 20px;">MindSpace</div>
            <p>Loading your safe space...</p>
        </div>
    </main>

    <nav class="nav-bar">
        <button class="nav-item active" onclick="route('home')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
                <polyline points="9 22 9 12 15 12 15 22" />
            </svg>
        </button>
        <button class="nav-item" onclick="route('chat')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" />
            </svg>
        </button>
        <button class="nav-item" onclick="route('peer')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
                <circle cx="9" cy="7" r="4" />
                <path d="M23 21v-2a4 4 0 0 0-3-3.87" />
                <path d="M16 3.13a4 4 0 0 1 0 7.75" />
            </svg>
        </button>
        <button class="nav-item" onclick="route('toolkit')">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <circle cx="12" cy="12" r="10" />
                <path d="M8 14s1.5 2 4 2 4-2 4-2" />
                <line x1="9" y1="9" x2="9.01" y2="9" />
                <line x1="15" y1="9" x2="15.01" y2="9" />
            </svg>
        </button>
    </nav>

    <!-- Crisis Modal -->
    <div id="crisisModal" class="overlay hidden">
        <div class="card" style="width: 90%; max-width: 350px; text-align: center; border-left: 6px solid #FF5252;">
            <div style="font-size: 3rem; margin-bottom: 10px;">‚ù§Ô∏è‚Äçü©π</div>
            <h2 style="margin-bottom: 10px; color: #FF5252;">Are you safe?</h2>
            <p style="color: var(--text-light); margin-bottom: 20px;">I'm sensing some distress. You don't have to go
                through this alone.</p>
            <div class="flex-col" style="gap: 10px;">
                <button class="btn btn-danger" onclick="window.open('tel:988')">Call 988 Lifeline</button>
                <button class="btn btn-secondary"
                    onclick="route('toolkit'); document.getElementById('crisisModal').classList.add('hidden')">Try
                    Grounding</button>
                <button class="btn" style="background:transparent; color: var(--text-light);"
                    onclick="document.getElementById('crisisModal').classList.add('hidden')">I'm okay, close</button>
            </div>
        </div>
    </div>

    <!-- Summary Modal -->
    <div id="summaryModal" class="overlay hidden">
        <div class="card" style="width: 90%; max-width: 350px;">
            <h3>Session Reflection üçÉ</h3>
            <p id="summaryText" style="margin: 15px 0; font-style: italic; color: var(--text-light);"></p>
            <button class="btn btn-primary" style="width:100%" onclick="closeSummary()">Close & Save</button>
        </div>
    </div>

    <!-- Load Supabase (UMD) for local file support -->

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>


    <script>
        // Global Error Handler
        window.onerror = function (msg, url, lineNo, columnNo, error) {
            console.error("Global Error:", msg, error);
            const app = document.getElementById('app');
            if (app) {
                app.innerHTML = `
                <div style="padding: 20px; text-align: center; color: #FF5252;">
                    <h3>Something went wrong</h3>
                    <p>${msg}</p>
                    <small>Check console for details.</small>
                </div>`;
            }
            return false;
        };



        //console.warn("Running in DEMO MODE (Supabase disabled)");
        // init() deferred to end

        // --- State Management ---
        const state = {
            theme: localStorage.getItem('theme') || 'light',
            userMoods: [], // {date, mood, note}
            msgCount: 0,
            chatHistory: [{ id: 0, text: `Hi! I'm your MindSpace companion. I'm here to listen, not to judge. How is your heart doing today?`, sender: 'ai' }],
            peerMode: 'talk', // talk | listen | circle
        };






        // --- Auth Functions (Demo) ---
        async function signIn(email, password) {
            // Simulate API delay
            await new Promise(r => setTimeout(r, 500));

            if (!email || !password) {
                alert("Please enter a demo email/password.");
                return;
            }

            // Fake Session
            state.user = { id: 'demo-123', email: email };
            alert('Logged in (Demo Mode)!');

            // Re-render
            init();
        }

        async function signUp(email, password) {
            alert('Demo Account Created! You can now just click Login.');
        }

        async function signOut() {
            state.user = null;
            state.userMoods = [];
            alert('Logged out');
            init();
        }

        // --- Core Functions ---
        async function init() {
            try {
                // Check session
                const { data, error } = await supabase.auth.getSession();
                if (error) throw error;

                state.user = data.session?.user || null;

                if (state.user) {
                    // Fetch mood history
                    const { data: moods } = await supabase
                        .from('moods')
                        .select('*')
                        .eq('user_id', state.user.id)
                        .order('created_at', { ascending: false });
                    state.userMoods = moods || [];
                } else {
                    state.userMoods = [];
                }
            } finally {
                setTheme(state.theme);
                route('home');
            }
        }

        function toggleTheme() {
            state.theme = state.theme === 'light' ? 'dark' : 'light';
            setTheme(state.theme);
        }

        function setTheme(t) {
            document.documentElement.setAttribute('data-theme', t);
            localStorage.setItem('theme', t);
        }

        function route(view) {
            state.view = view;
            document.querySelectorAll('.nav-item').forEach(btn => btn.classList.remove('active'));
            const map = { 'home': 0, 'chat': 1, 'peer': 2, 'toolkit': 3 };

            // Only highlight if valid nav item
            if (document.querySelectorAll('.nav-item')[map[view]])
                document.querySelectorAll('.nav-item')[map[view]].classList.add('active');

            render();
        }

        // --- Render Views ---
        function render() {
            const app = document.getElementById('app');
            app.innerHTML = '';

            if (state.view === 'home') renderHome(app);
            else if (state.view === 'chat') renderChat(app);
            else if (state.view === 'peer') renderPeer(app);
            else if (state.view === 'toolkit') renderToolkit(app);
            else if (state.view === 'admin') renderAdmin(app);
        }

        function renderHome(container) {
            // Logged Out UI
            if (!state.user) {
                container.innerHTML = `
    <div class="fade-in flex-center flex-col" style="height: 70vh;">
        <h1 class="logo" style="margin-bottom: 20px; font-size: 2.5rem;">MindSpace</h1>
        <div class="card" style="width: 100%; max-width: 350px; text-align: center;">
            <h3 style="margin-bottom: 15px;">Welcome</h3>
            <p style="color: var(--text-light); margin-bottom: 20px;">Your safe space awaits.</p>

            <input id="email" type="email" placeholder="Email"
                style="width: 100%; padding: 12px; margin-bottom: 10px; border-radius: 12px; border: 1px solid var(--border-light); background: var(--bg-color); color: var(--text-main);">
            <input id="password" type="password" placeholder="Password"
                style="width: 100%; padding: 12px; margin-bottom: 20px; border-radius: 12px; border: 1px solid var(--border-light); background: var(--bg-color); color: var(--text-main);">

            <div class="flex-col" style="gap: 10px;">
                <button class="btn btn-primary" style="width: 100%; justify-content: center;" onclick="window.signIn(
                                    document.getElementById('email').value,
                                    document.getElementById('password').value
                                )">Login</button>
                <button class="btn btn-secondary" style="width: 100%; justify-content: center;" onclick="window.signUp(
                                    document.getElementById('email').value,
                                    document.getElementById('password').value
                                )">Sign Up</button>
            </div>
        </div>
    </div>
    `;
                return;
            }

            // Logged In UI
            const insight = state.userMoods.length > 2 ? `Pattern: You tend to feel anxious on Sundays. Be kind to yourself tomorrow!` : "Welcome back to your safe space.";

            container.innerHTML = `
    <div class="fade-in">
        <div class="flex-between" style="margin-bottom: 15px;">
            <div>
                <h1 style="margin-bottom: 5px;">Hi, Student üëã</h1>
                <p style="color: var(--text-light);">${insight}</p>
            </div>
            <button onclick="window.signOut()" class="btn"
                style="padding: 6px 12px; font-size: 0.8rem; background: var(--surface-color); border: 1px solid var(--border-light);">Logout</button>
        </div>

        <div class="card">
            <div class="flex-between">
                <h3>Mood Check-in</h3>
                <span style="font-size: 0.8rem; color: var(--text-light)">Just now</span>
            </div>
            <div class="mood-grid">
                <button class="mood-btn" style="background: var(--mood-awful)"
                    onclick="window.logMood(1, this)">üò´</button>
                <button class="mood-btn" style="background: var(--mood-bad)"
                    onclick="window.logMood(2, this)">üòî</button>
                <button class="mood-btn" style="background: var(--mood-meh)"
                    onclick="window.logMood(3, this)">üòê</button>
                <button class="mood-btn" style="background: var(--mood-good)"
                    onclick="window.logMood(4, this)">üôÇ</button>
                <button class="mood-btn" style="background: var(--mood-great)"
                    onclick="window.logMood(5, this)">üòÑ</button>
            </div>
            <input type="text" id="moodNote" placeholder="Add a note (optional)..."
                style="width: 100%; margin-top: 15px; padding: 12px; border-radius: 12px; border: 1px solid var(--border-light); background: var(--bg-color); color: var(--text-main);">
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
            <div class="card" onclick="route('chat')"
                style="cursor: pointer; background: var(--gradient-secondary); color: white;">
                <h3>Vent AI</h3>
                <p style="font-size: 0.9rem; opacity: 0.9;">Safe & Private</p>
            </div>
            <div class="card" onclick="route('peer')"
                style="cursor: pointer; background: var(--gradient-primary); color: white;">
                <h3>Connect</h3>
                <p style="font-size: 0.9rem; opacity: 0.9;">Find Peers</p>
            </div>
        </div>

        <div class="card" onclick="route('admin')" style="cursor: pointer; border-left: 4px solid var(--secondary);">
            <h3>Campus Resources</h3>
            <p style="font-size: 0.9rem; color: var(--text-light);">Professional help & Faculty Dashboard</p>
        </div>
    </div>
    `;
        }

        function renderChat(container) {
            container.innerHTML = `
    <div class="fade-in" style="height: 100%; display: flex; flex-direction: column;">
        <div
            style="font-size: 0.75rem; text-align: center; color: var(--text-light); margin-bottom: 10px; background: rgba(0,0,0,0.05); padding: 5px; border-radius: 10px;">
            ‚ö†Ô∏è AI is not a therapist. For emergencies, call 988.
        </div>

        <div id="chatHistory" class="chat-area">
            ${state.chatHistory.map(m => `<div class="msg ${m.sender === 'ai' ? 'msg-ai' : 'msg-user'}">${m.text}</div>
            `).join('')}
        </div>

        <div style="margin-top: auto; padding-top: 10px; display: flex; gap: 10px;">
            <input type="text" id="chatInput" placeholder="Type here..."
                style="flex: 1; padding: 15px; border-radius: 30px; border: 1px solid var(--border-light); background: var(--surface-color); color: var(--text-main); outline: none; box-shadow: var(--shadow-card);"
                onkeypress="if(event.key==='Enter') window.sendChat()">
            <button onclick="window.sendChat()" class="btn btn-primary" style="width: 50px; padding: 0;">‚û§</button>
        </div>
        <div style="text-align: center; margin-top: 5px;">
            <button onclick="window.endSession()"
                style="background: none; border: none; font-size: 0.8rem; color: var(--text-light); cursor: pointer;">End
                Session & Reflect</button>
        </div>
    </div>
    `;
            setTimeout(() => {
                const h = document.getElementById('chatHistory');
                if (h) h.scrollTop = h.scrollHeight;
            }, 100);
        }

        function renderPeer(container) {
            container.innerHTML = `
    <div class="fade-in">
        <h2>Peer Support ü§ù</h2>
        <p style="color: var(--text-light); margin-bottom: 20px;">Connect anonymously with students who get it.</p>

        <div class="card">
            <h3>Choose Mode</h3>
            <div style="display: flex; gap: 10px; margin-top: 15px;">
                <button class="btn ${state.peerMode === 'talk' ? 'btn-primary' : 'btn-secondary'}" style="flex:1"
                    onclick="state.peerMode='talk'; render()">üó£ Talk</button>
                <button class="btn ${state.peerMode === 'listen' ? 'btn-primary' : 'btn-secondary'}" style="flex:1"
                    onclick="state.peerMode='listen'; render()">üëÇ Listen</button>
            </div>
            <div style="margin-top: 10px;">
                <button class="btn ${state.peerMode === 'circle' ? 'btn-primary' : 'btn-secondary'}" style="width:100%"
                    onclick="state.peerMode='circle'; render()">‚≠ï Join Support Circle</button>
            </div>
        </div>

        <div class="card">
            <h3>Select Topic</h3>
            <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px;">
                ${['Anxiety', 'Exam Stress', 'Loneliness', 'Relationships', 'Burnout'].map(t =>
                `<span
                    style="padding: 6px 14px; background: var(--bg-color); border-radius: 15px; font-size: 0.9rem; border: 1px solid var(--border-light); cursor: pointer;"
                    onclick="this.style.background='var(--primary)'; this.style.color='white'">${t}</span>`
            ).join('')}
            </div>
        </div>

        <div class="card">
            <h3>Community Guidelines</h3>
            <ul style="font-size: 0.9rem; color: var(--text-light); padding-left: 20px; margin-top: 5px;">
                <li>Be respectful and kind.</li>
                <li>No medical advice.</li>
                <li>Report inappropriate behavior.</li>
            </ul>
            <button class="btn" onclick="route('peer')">Start Chat</button>

        </div>
    </div>
    `;
        }

        function renderToolkit(container) {
            container.innerHTML = `
    <div class="fade-in">
      <h2>Toolkit üõ†</h2>
<p style="color: var(--text-light); margin-bottom: 20px;">Ground yourself.</p>

<!-- Box Breathing -->
<div class="card" style="text-align: center;">
  <h3>Box Breathing</h3>
  <div id="breatheCircle"
    style="width: 100px; height: 100px; background: var(--gradient-primary); border-radius: 50%; margin: 20px auto; transition: 4s; display:flex; align-items:center; justify-content:center; color:white; font-weight:bold; cursor:pointer; box-shadow: 0 0 20px rgba(0,200,255,0.5);"
    onclick="window.toggleBreath(this)">
    Start
  </div>
  <p id="breatheLabel">Tap to begin</p>
</div>

<!-- Gratitude Journal -->
<div class="card">
  <h3>Gratitude Journal</h3>
  <input type="text" placeholder="I am grateful for..."
    style="width: 100%; padding: 10px; border-radius: 10px; border: 1px solid var(--border-light); background: var(--bg-color); color: var(--text-main);">
  <button class="btn btn-secondary" style="margin-top: 10px; font-size: 0.9rem;"
    onclick="alert('Saved to private storage!')">
    Save Entry
  </button>
</div>

<!-- Body Scan -->
<div class="card">
  <h3>Body Scan</h3>
  <p style="font-size: 0.9rem; color: var(--text-light);">
    Close your eyes. Start from your toes. Tense them for 5 seconds, then release. Move up to your calves...
  </p>
</div>

<!-- üéß Calm Sounds -->
  <div class="card" style="margin-top: 20px;">
  <h3>üéß Calm Sounds</h3>
  <p style="opacity:0.8">Play gentle background music to relax.</p>

  <div style="display:flex; gap:10px; margin-top:10px;">
    <button class="btn" onclick="playMeditation()">Play</button>
    <button class="btn btn-secondary" onclick="stopMeditation()">Stop</button>
  </div>
</div>

</div>

        </div>
    </div>
    `;
        }

        function renderAdmin(container) {
            container.innerHTML = `
    <div class="fade-in">
        <div class="flex-between">
            <h2>Admin Dashboard</h2>
            <button class="btn btn-secondary" style="padding: 5px 10px; font-size: 0.8rem;"
                onclick="window.route('home')">Exit</button>
        </div>
        <p style="color: var(--text-light); margin-bottom: 20px;">Campus-wide Mental Health Overview</p>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px;">
            <div class="card" style="text-align: center;">
                <div style="font-size: 2rem; font-weight: 700; color: var(--primary);">84%</div>
                <div style="font-size: 0.8rem; color: var(--text-light);">Positive Sentiment</div>
            </div>
            <div class="card" style="text-align: center;">
                <div style="font-size: 2rem; font-weight: 700; color: #FF5252;">3</div>
                <div style="font-size: 0.8rem; color: var(--text-light);">Crises Intercepted</div>
            </div>
        </div>

        <div class="card">
            <h3>Mood Trends (Weekly)</h3>
            <div style="display: flex; align-items: flex-end; gap: 8px; height: 100px; margin-top: 15px;">
                <div style="flex:1; background: var(--mood-meh); height: 40%; border-radius: 4px;"></div>
                <div style="flex:1; background: var(--mood-bad); height: 80%; border-radius: 4px;"></div>
                <div style="flex:1; background: var(--mood-good); height: 60%; border-radius: 4px;"></div>
                <div style="flex:1; background: var(--mood-great); height: 50%; border-radius: 4px;"></div>
                <div style="flex:1; background: var(--mood-meh); height: 70%; border-radius: 4px;"></div>
                <div style="flex:1; background: var(--mood-good); height: 90%; border-radius: 4px; opacity:0.5;"></div>
            </div>
            <p style="font-size: 0.8rem; color: var(--text-light); margin-top: 10px; text-align: center;">Peak stress
                detected: Mid-term week</p>
        </div>

        <div class="card" style="border-left: 4px solid var(--secondary);">
            <h3>Professional Resources</h3>
            <ul style="padding-left: 20px; font-size: 0.9rem; margin-top:10px;">
                <li>Dr. Smith (Available)</li>
                <li>Campus Clinic (Open)</li>
            </ul>
        </div>
    </div>
    `;
        }

        // --- Logic ---
        async function logMood(level, btn) {
            // UI highlight
            document.querySelectorAll('.mood-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');

            // get note from textarea
            const note = document.getElementById('moodNote').value;


        }

        function sendChat() {
            const input = document.getElementById('chatInput');
            const txt = input.value.trim();
            if (!txt) return;

            // Crisis Check (Rainbow-Regex)
            if (/(die|kill|suicide|end my life|hurt myself)/i.test(txt)) {
                document.getElementById('crisisModal').classList.remove('hidden');
                return;
            }

            state.msgCount++;
            state.chatHistory.push({ id: Date.now(), text: txt, sender: 'user' });
            input.value = '';
            render(); // update view immediately

            // Fake Typing
            const history = document.getElementById('chatHistory');
            const typing = document.createElement('div');
            typing.className = 'typing';
            typing.innerHTML = `<div class="dot"></div>
    <div class="dot"></div>
    <div class="dot"></div>`;
            history.appendChild(typing);
            history.scrollTop = history.scrollHeight;

            setTimeout(() => {
                typing.remove();
                let reply = "I'm here.";

                // Simple Logic (Mock AI)
                const t = txt.toLowerCase();
                if (t.includes('sad') || t.includes('cry')) reply = "I hear that sadness in your words. It's okay to let it out.";
                else if (t.includes('stress') || t.includes('exam')) reply = `Exams can be so overwhelming. Are you taking small breaks?`;
                else if (t.includes('tired')) reply = "Rest is productive too. Have you slept well lately?";
                else reply = "Tell me more about that.";

                // Dependency Guard
                if (state.msgCount > 5 && state.msgCount % 5 === 0) {
                    reply += " <br><br><i>(I've enjoyed our chat. If you need more connection, our Peer Circles are open.)</i>";
                }

                state.chatHistory.push({ id: Date.now() + 1, text: reply, sender: 'ai' });
                render();
            }, 1200);
        }

        function endSession() {
            document.getElementById('summaryText').innerText = `You showed great courage by venting today. You seem to be processing some stress, but approached it with self-awareness. Take care!`;
            document.getElementById('summaryModal').classList.remove('hidden');
        }

        function closeSummary() {
            state.chatHistory = [{ id: 0, text: "New session. How can I support you?", sender: 'ai' }];
            state.msgCount = 0;
            document.getElementById('summaryModal').classList.add('hidden');
            route('home');
        }

        function toggleBreath(el) {
            if (el.innerText === 'Start') {
                el.innerText = "Inhale";
                el.style.transform = "scale(1.5)";
                document.getElementById('breatheLabel').innerText = "Hold...";
                setTimeout(() => {
                    el.innerText = "Exhale";
                    el.style.transform = "scale(1)";
                    document.getElementById('breatheLabel').innerText = "Release...";
                }, 4000);
            } else {
                el.innerText = "Start";
            }
        }

        // --- Expose functions to window ---
        window.toggleTheme = toggleTheme;
        window.route = route;
        window.logMood = logMood;
        window.sendChat = sendChat;
        window.endSession = endSession;
        window.closeSummary = closeSummary;
        window.toggleBreath = toggleBreath;
        window.signIn = signIn;
        window.signUp = signUp;
        window.signOut = signOut;

        // Start
        init();
    </script>
    <!-- Global Audio (Hidden) -->
    <audio id="meditationAudio" loop>
        <source src="https://cdn.pixabay.com/download/audio/2022/10/03/audio_7c6c3c2c21.mp3" type="audio/mpeg">
    </audio>

    <!-- SOS Button -->
    <button id="sosBtn">SOS</button>

    <!-- SOS Modal -->
    <div id="sosModal" class="sos-modal">
        <div class="sos-box">
            <h2>Need Immediate Help?</h2>
            <p>You are not alone. Please reach out:</p>
            <ul>
                <li><strong>India ‚Äì AASRA:</strong> üìû 91-9820466726</li>
                <li><strong>Kiran (Govt.):</strong> üìû 1800-599-0019</li>
                <li><strong>Emergency:</strong> üìû 112</li>
            </ul>
            <button id="closeSos">Close</button>
        </div>
    </div>

    <script>
        // --- Global Helpers ---
        window.playMeditation = function () {
            const audio = document.getElementById("meditationAudio");
            if (audio) {
                audio.play().catch(e => console.error("Audio play error:", e));
            }
        };

        window.stopMeditation = function () {
            const audio = document.getElementById("meditationAudio");
            if (audio) {
                audio.pause();
                audio.currentTime = 0;
            }
        };

        // SOS Logic
        const sosBtn = document.getElementById("sosBtn");
        const sosModal = document.getElementById("sosModal");
        const closeSos = document.getElementById("closeSos");

        if (sosBtn && sosModal && closeSos) {
            sosBtn.onclick = () => sosModal.style.display = "flex";
            closeSos.onclick = () => sosModal.style.display = "none";
        }
    </script>
</body>

</html>